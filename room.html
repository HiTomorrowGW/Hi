<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>방 상세 정보 - HiTomorrow</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
</head>
<body>

    <div id="navbar-placeholder"></div>

    <!-- Room Detail Section -->
    <div class="container my-5">
        <div id="room-detail-container">
            <div class="row">
                <!-- Main Content Column (Left) -->
                <div class="col-lg-8">
                    <!-- Room Image Section -->
                    <div class="mb-4">
                        <img id="room-main-image" src="" class="img-fluid rounded" alt="Room Image">
                    </div>

                    <!-- Room Name and Location -->
                    <h1 id="room-name" class="mb-2"></h1>
                    <p id="room-location" class="lead text-muted mb-4">위치 정보 (추후 추가)</p>

                    <!-- Key Details (Placeholder) -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <p><i class="bi bi-people-fill me-2"></i><span id="room-capacity"></span> 게스트</p>
                        </div>
                        <div class="col-md-4">
                            <p><i class="bi bi-door-open-fill me-2"></i><span id="room-bedrooms"></span> 침실</p>
                        </div>
                        <div class="col-md-4">
                            <p><i class="bi bi-toilet-fill me-2"></i><span id="room-bathrooms"></span> 욕실</p>
                        </div>
                    </div>

                    <hr class="my-4">

                    <!-- Description -->
                    <h2 class="mb-3">설명</h2>
                    <p id="room-description" class="mb-4"></p>

                    <hr class="my-4">

                    <!-- Image Carousel -->
                    <div id="roomCarousel" class="carousel slide mb-4" data-bs-ride="carousel">
                        <div class="carousel-indicators">
                            <!-- Indicators will be dynamically loaded here -->
                        </div>
                        <div class="carousel-inner">
                            <!-- Carousel items will be dynamically loaded here -->
                        </div>
                        <button class="carousel-control-prev" type="button" data-bs-target="#roomCarousel" data-bs-slide="prev">
                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Previous</span>
                        </button>
                        <button class="carousel-control-next" type="button" data-bs-target="#roomCarousel" data-bs-slide="next">
                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                            <span class="visually-hidden">Next</span>
                        </button>
                    </div>

                    <hr class="my-4">

                    <!-- Amenities Section -->
                    <h2 class="mb-3">편의 시설</h2>
                    <div class="row mb-4" id="room-amenities">
                        <!-- Amenities will be dynamically loaded here -->
                    </div>

                    

                    

                    

                </div>

                <!-- Booking Card Column (Right) -->
                <div class="col-lg-4">
                    <div class="card shadow-sm sticky-top" style="top: 80px;">
                        <div class="card-body">
                            
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 푸터 -->
    <footer class="py-5 bg-dark">
        <div class="container">
            <p class="m-0 text-center text-white">Copyright &copy; Room Share 2025</p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const roomId = urlParams.get('id');
            const roomDetailContainer = document.getElementById('room-detail-container');

            if (roomId) {
                fetch(`/api/rooms/${roomId}`)
                    .then(response => {
                        if (!response.ok) {
                            if (response.status === 404) {
                                return response.json().then(err => {
                                    throw new Error(err.error || 'Room not found');
                                });
                            }
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(room => {
                        document.getElementById('room-main-image').src = room.image_url;
                        document.getElementById('room-main-image').alt = room.name;
                        document.getElementById('room-name').innerText = room.name;
                        // Placeholder for location - not in current room object
                        // document.getElementById('room-location').innerText = room.location;
                        document.getElementById('room-description').innerText = room.description;
                        

                        // Placeholder for key details - not in current room object
                        document.getElementById('room-capacity').innerText = '4'; // Example value
                        document.getElementById('room-bedrooms').innerText = '2'; // Example value
                        document.getElementById('room-bathrooms').innerText = '1'; // Example value

                        // Amenities
                        const amenitiesListContainer = document.getElementById('room-amenities');
                        amenitiesListContainer.innerHTML = ''; // Clear existing placeholders
                        if (room.amenities && room.amenities.length > 0) {
                            const ul1 = document.createElement('ul');
                            ul1.className = 'list-unstyled';
                            const ul2 = document.createElement('ul');
                            ul2.className = 'list-unstyled';

                            room.amenities.forEach((amenity, index) => {
                                const li = document.createElement('li');
                                li.innerHTML = `<i class="bi bi-check-circle-fill me-2 text-success"></i> ${amenity}`;
                                if (index % 2 === 0) { // Distribute into two columns for better layout
                                    ul1.appendChild(li);
                                } else {
                                    ul2.appendChild(li);
                                }
                            });
                            const col1 = document.createElement('div');
                            col1.className = 'col-md-6';
                            col1.appendChild(ul1);
                            const col2 = document.createElement('div');
                            col2.className = 'col-md-6';
                            col2.appendChild(ul2);
                            amenitiesListContainer.appendChild(col1);
                            amenitiesListContainer.appendChild(col2);
                        } else {
                            amenitiesListContainer.innerHTML = '<div class="col-12"><p>제공되는 편의 시설이 없습니다.</p></div>';
                        }

                        // Image Carousel
                        const carouselIndicators = document.querySelector('#roomCarousel .carousel-indicators');
                        const carouselInner = document.querySelector('#roomCarousel .carousel-inner');
                        carouselIndicators.innerHTML = '';
                        carouselInner.innerHTML = '';

                        if (room.additional_images && room.additional_images.length > 0) {
                            // Set the main image to the first image
                            document.getElementById('room-main-image').src = room.additional_images[0];

                            // Use the rest of the images for the carousel
                            const galleryImages = room.additional_images.slice(1);

                            if (galleryImages.length > 0) {
                                galleryImages.forEach((imageUrl, index) => {
                                    // Create indicator
                                    const indicator = document.createElement('button');
                                    indicator.setAttribute('type', 'button');
                                    indicator.setAttribute('data-bs-target', '#roomCarousel');
                                    indicator.setAttribute('data-bs-slide-to', index);
                                    if (index === 0) {
                                        indicator.classList.add('active');
                                        indicator.setAttribute('aria-current', 'true');
                                    }
                                    indicator.setAttribute('aria-label', `Slide ${index + 1}`);
                                    carouselIndicators.appendChild(indicator);

                                    // Create carousel item
                                    const carouselItem = document.createElement('div');
                                    carouselItem.classList.add('carousel-item');
                                    if (index === 0) {
                                        carouselItem.classList.add('active');
                                    }
                                    const img = document.createElement('img');
                                    img.src = imageUrl;
                                    img.classList.add('d-block', 'w-100', 'rounded');
                                    img.alt = `Room Image ${index + 2}`; // Alt text reflects correct image number
                                    carouselItem.appendChild(img);
                                    carouselInner.appendChild(carouselItem);
                                });
                            } else {
                                // If there are no other images, hide the carousel section
                                document.getElementById('roomCarousel').style.display = 'none';
                            }
                        } else if (room.image_url) {
                            // Fallback to single image if no additional images
                            document.getElementById('room-main-image').src = room.image_url;
                             // Hide carousel if no additional images
                            document.getElementById('roomCarousel').style.display = 'none';
                        } else {
                            // Hide carousel if no images at all
                            document.getElementById('roomCarousel').style.display = 'none';
                        }
                    })
                    .catch(error => {
                        console.error('Error fetching room details:', error);
                        roomDetailContainer.innerHTML = `<div class="alert alert-danger" role="alert">방 정보를 불러오는 데 실패했습니다: ${error.message}</div>`;
                    });
            } else {
                roomDetailContainer.innerHTML = `<div class="alert alert-warning" role="alert">방 ID가 제공되지 않았습니다.</div>`;
            }
        });
    </script>
</body>
</html>